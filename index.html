<!DOCTYPE html>
<html>
	<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width" />
	<title>history</title>
	</head>
	<body>
		<h1>Match Play History</h1>
		<div id="token-entry">
			<h2>API Token Required</h2>
			<form id="token-form">
				<input type="password" placeholder="api token" name="token" id="token">
				<input type="submit">
			</form>
		</div>
		<div id="main">
			<div id="my-tournaments" class="tabs" data-tabgroup="my-tournaments">
				<h2>My Tournaments</h2>
			</div>

			<div id="active-tournament" class="tabs" data-tabgroup="active-tournament">
			</div>
			<div id="player-histories"></div>
		</div>
		<div id="log">
		</div>
		<script>
			window.onerror = function(message, source, lineno, colno, error) {
				let e = `window.onerror\n${source}\nline ${lineno}:${colno}\n\n${message}`
				if (error) e += `\n\n${error.message}\n${error.stack}`
				alert(e)
				log(e)
			};
			function stringify(value) {
				switch (typeof value) {
					case 'string': case 'object': return JSON.stringify(value, null, 4);
					default: return String(value);
				}
			};
			function log (obj) {
				let message = stringify(obj)
				if (message.slice(0, 1) == '"') message = obj
				let el = document.createElement('pre')
				el.textContent = message
				let logobj = document.querySelector('#log')
				logobj.prepend(el)
				// logobj.scrollIntoView()
			}
			function catcher(err) {
				log(`${err.message}\n${err.stack}`)
				log(err)
				throw(err)
			}
			document.querySelector('#log').addEventListener('click', () => {document.querySelector('#log').prepend('tap')})
			async function load(src, loader) {
				try {
					let t = Date.now()
					let s = `${src}?t=${t}`
					await loader(s)
				} catch (err) {
					catcher(err)
				}
			}
			async function loadjs(src) {
				await load(src, scriptloader)
			}
			async function loadcss(src) {
				await load(src, cssloader)
			}
			async function cssloader(src) {
				await new Promise(function (res, rej) {
					let el = document.createElement('link')
					el.addEventListener('error', rej)
					el.addEventListener('load', res)
					el.async = true
					el.setAttribute('rel', 'stylesheet')
					el.setAttribute('href', src)
					document.head.append(el)
				})
			}
			async function scriptloader(scriptUrl){
				await new Promise(function (res, rej) {
					let script = document.createElement('script');
					script.addEventListener('error',rej);
					script.addEventListener('load',res);
					script.src = scriptUrl;
					script.type = 'text/javascript';
					script.onerror = rej;
					script.async = true;
					script.onload = res;
					document.head.append(script);
				})
			}
			try {
				loadcss('history.css')
				loadjs('history.js')
			} catch (err) {
				catcher(err)
			}
		</script>
	</body>
</html>

<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width" />
  <title>history</title>
  <link rel="stylesheet" href="history.css" />
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
</head>
<body>
	<h1>Match Play History</h1>
	<div id="token-entry">
		<h2>API Token Required</h2>
		<form id="token-form">
			<input type="password" placeholder="api token" name="token" id="token">
			<input type="submit">
		</form>
	</div>
	<div id="main">
		<h2>Active Tournaments</h2>
		<div id="active-tournaments" class="clickables boxgroup">
			<div class="fake box"></div>
			<div class="fake box"></div>
			<div class="fake box"></div>
			<div class="fake box"></div>
			<div class="fake box"></div>
			<div class="fake box"></div>
			<div class="fake box"></div>
			<div class="fake box"></div>
			<div class="fake box"></div>
			<div class="fake box"></div>
		</div>
		<div class="expander"></div>
		<h2>Games in <span id="active-tournament-title"></span></h2>
		<div id="active-games" class=" clickables boxgroup">

		</div>
		<div class="expander"></div>
		<div id="player-histories"></div>
		<h2>All Players</h2>
		<div id="players" class="clickables boxgroup">
			<div class="fake box"></div>
			<div class="fake box"></div>
			<div class="fake box"></div>
			<div class="fake box"></div>
			<div class="fake box"></div>
			<div class="fake box"></div>
			<div class="fake box"></div>
			<div class="fake box"></div>
			<div class="fake box"></div>
			<div class="fake box"></div>
		</div>
		<div class="expander"></div>
	</div>
	<h2>Log</h2>
	<div id="log">
	</div>
	<script>
		window.onerror = function(error, url, line) {
			let e = `window.onerror\n${url}\nline ${line}\n\n${error}`
			alert(e)
			let li = $('<pre>').addClass('windowerror').text(e).prependTo($('#log'))
		}
		function stringify(value) {
			switch (typeof value) {
				case 'string': case 'object': return JSON.stringify(value, null, 4);
				default: return String(value);
			}
		};
		function log (obj) {
			let message = stringify(obj)
			if (message.slice(0, 1) == '"') message = message.slice(1,-1)
			$('#log').prepend($('<pre>').text(message))
		}
		async function load(src) {
			try {
				let t = Date.now()
				let s = `${src}?t=${t}`
				await loader(s)
				log("script successfully loaded"); 
			} catch (err) {
				log(err.toString())
				log(err.line)
			}
		}
		function loader(scriptUrl){
			return new Promise(function (res, rej) {
				let script = document.createElement('script');
				script.src = scriptUrl;
				script.type = 'text/javascript';
				script.onerror = rej;
				script.async = true;
				script.onload = res;
				script.addEventListener('error',rej);
				script.addEventListener('load',res);
				document.head.appendChild(script);
			})
		}
		try {
			load('history.js')
		} catch (err) {
			alert('error loading history.js')
			alert(err)
		}
		</script>
	</body>
</html>
